<% if current_user.goals.count > 0 %>
  <table class="table">
    <thead>
      <th> </th>
      <th class="text-center">XP Gains</th>
      <th class="text-center">Total XP</th>
      <th class="text-center">XP Today</th>
      <th class="text-center">Streak</th>
      <th class="text-right">Actions</th>
    </thead>
  </table>
    <div class="tbl-content">
      <table>
        <tbody>
          <% @user_goals.each do |goal| %>
            <tr class="<%= if goal.warn_streak_loss then "bg-danger" end %>" id="goal_<%= goal.id %>">
              <td class="left-col"><strong><%= link_to goal.name, goal_path(goal) %></strong></td>
              <td class="text-center"><%= goal.xp_value %></td>
              <td class="text-center"><%= goal.total_goal_xp %></td>
              <td class="text-center"><%= goal.daily_goal_xp %></td>
              <td class="text-center">
                <% if goal.calculate_length_of_streak >= 5 && !goal.warn_streak_loss %>
                  <span class="fa-stack fa-2x">
                    <i class="fa fa-star-o fa-stack-2x"></i>
                    <small class="star-text"><%= goal.calculate_length_of_streak.to_i %></small>
                  </span>
                <% elsif goal.warn_streak_loss %>
                  <span class="fa-stack fa-2x">
                    <i class="fa fa-exclamation fa-stack-2x"></i>
                  </span>
                <% else %>
                  <%= progress_bar goal.calculate_length_of_streak/5 %>
                <% end %>
              </td>
              <td class="text-right right-col">
                <span class="fa-stack fa-2x">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#myUpdateGoal_<%= goal.id %>">
                  <i class="fa fa-edit"></i>
                </button>
                
                <%= link_to goal_path(goal), method: :delete, data: 
                  {confirm: "Are you sure you want to delete this goal?\n
                  You will lose all data relating to this goal."}, 
                  class: "btn btn-xs btn-danger" do %>
                   <i class="fa fa-trash"></i>
                <% end %>
                </span>
              </td>
              <%= form_for(goal, :method => :put) do |f| %>
                  <div class="modal fade" id="myUpdateGoal_<%= goal.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <h4 class="modal-title" id="myModalLabel">Edit Goal</h4>
                        </div>
                        <div class="modal-body">
                          <div class="form-group">
                            <%= f.label :name %>
                            <%= f.text_field :name, class: 'form-control', placeholder: "Enter goal name...", autofocus: true  %>
                          </div>
                          <div class="form-group">
                            <%= f.label :description %>
                            <%= f.text_area :description, rows: 4, class: 'form-control', placeholder: "Write a quick motivational message to keep you inspired..." %>
                          </div>
                          <div class="form-group">
                            <%= f.label :xp_value %>
                            <%= f.number_field :xp_value, min: 1, max: 5000, class:"form-control", placeholder: "Enter XP value..." %>
                          </div>
                          <div class="form-group">
                            <%= f.label "Minimum occurence" %>
                            <%= f.select :recurrence_id, options_for_select([['Daily', 1], ['Weekly', 2], ['Monthly', 3], ['One-off', 4]], f.object.recurrence_id) %>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <div class="form-group">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <%= f.submit class:"btn btn-success btn-md" %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </table>
<% else %>
  <h4 class="text-center">You have no goals yet!</h4>
  </br>
  <div class="text-center">
    <%= link_to "Create new goal", new_goal_path, class: "btn btn-primary btn-lg" %>
  </div>
<% end %>

